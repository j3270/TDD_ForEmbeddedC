cmake_minimum_required(VERSION 3.0.0)
project(StdioTestsUnity VERSION 0.1.0)

include(CTest)
enable_testing()

add_subdirectory(
    ${CMAKE_CURRENT_SOURCE_DIR}/../../../Unity
    ${CMAKE_CURRENT_SOURCE_DIR}/build/Uinty
    EXCLUDE_FROM_ALL
)

set(SOURCES
    ${CMAKE_CURRENT_SOURCE_DIR}/main.c
    ${CMAKE_CURRENT_SOURCE_DIR}/SprintfTest.c
    ${CMAKE_CURRENT_SOURCE_DIR}/SprintfTestRunner.c
)

set(UNITY_INCLUDE_DIRS
    ${CMAKE_CURRENT_SOURCE_DIR}/../../../Unity/src
    ${CMAKE_CURRENT_SOURCE_DIR}/../../../Unity/extras/fixture/src
    ${CMAKE_CURRENT_SOURCE_DIR}/../../../Unity/extras/memory/src
)

set(INCLUDE_DIRS ${UNITY_INCLUDE_DIRS})

set(DEFINES )

set(EXECUTABLE StdioTestsUnity)
add_executable(${EXECUTABLE} ${SOURCES})

target_include_directories(${EXECUTABLE} PRIVATE ${INCLUDE_DIRS})

target_compile_definitions(${EXECUTABLE} PRIVATE ${DEFINES})

target_link_libraries(${EXECUTABLE} $<TARGET_FILE:unity>)

add_test(
    NAME "StdioTestsUnity" 
    COMMAND $<TARGET_FILE:StdioTestsUnity> "-v")